# LibTCS笔记

## 简介

LibTCS基于OpenTCS这一Java开源软件，并对OpenTCS进行了大幅简化。目前LibTCS采取最短距离作为最优路径算法，为多类型载具提供基本的调度支持。

`Map`地图类是LibTCS的基础。用户应当首先通过其创建者`MapBuilder`类创建一个`Map`，并确保该地图信息与载具一致。

在拥有了一个可用的地图类后，用户将使用该地图初始化一个`Kernal`控制核心类。该类此时将处在待机状态。

随后，用户应当为各载具指定其对应的`VehicleController`载具控制器。载具控制器拥有一套接口供控制核心使用。对于实际载具，用户需要实现载具控制器的`VehicleAdapter`模块，该模块将连接至实际载具，并将LibTCS指令转化为载具指令。用户还需要为每一台载具设定一个初始化位置，该位置与载具现实所在的位置一致。

在完成以上设定后，即可通过调用控制核心的`Start()`函数启动控制核心类。随后控制核心便进入工作模式。

在工作模式中，用户可以调用`AddTransportOrder()`函数添加订单。控制核心会负责将订单分配给各载具并监督整个系统的运行。

通过调用`Exit()`函数，控制核心类会停止工作。注意目前LibTCS不提供重启功能，因此仅在退出程序时调用该函数。

## 地图

`Map`地图是对真实场景的抽象，为图论理论中的有向有权重图。LibTCS规定的地图元素有：路径点`Point`，路径`Path`，地点`Location`，区域`Block`，载具`Vehicle`。

该地图应当与AGV所使用的地图保持一致。

### `MapObject`

所有地图元素都继承自该类。该类存储了地图元素的唯一ID和类型信息。

### `MapResource`

地图资源类派生了MapObject，存储所属Block的信息。Point、Path、Location继承自该类，属于地图资源。控制核心会负责一份地图资源同时仅被分配至同一台载具。

### `Point`

路径点是基本的地图元素，载具经过或停泊在这些点上，而不是漫无目的地在地图空间中移动。它相当于图论中的点。

Point类中存储了该点的三维坐标及其他信息。一个点可以是报告、暂停、停泊三种类型。在报告点，载具需通知系统它的到达，但不被允许在该点暂停（等待前进方向资源并不被认为是暂停，因其依旧在执行移动指令）；在暂停点，除报告点的权力外，载具被允许在该点暂停以执行相关操作；在停泊点，除暂停点的权力外，载具被允许在无分派订单时长时间停留。

### `Path`

路径也是基本的地图元素，连接不同的路径点。它相当于图论中的有向边。路径是现实载具从起点至终点路线的一种抽象，其仅存储该路线的长度，而不关心形状。

Path类中存储了该点的长度以及起、终点信息。

### `Location`

地点是一个抽象存在，并不具有实体。它是一系列路径点及可执行操作`Operation`的集合。即在这些路径点，载具可以执行这些操作。一个操作`Operation`是用户定义的字符串。

### `Block`

区域是一系列地图资源的集合。同属一个区域的资源同时会被分配给一台载具。

> 该类型对于设计一个合理运行的地图十分重要。例如叉路口、断头路、双向边等地图要素都应当被整合在同一个block内。

### `Vehicle`

作为地图元素的载具类管理了载具对LibTCS而言重要的参数信息。但对于一个可工作的系统而言，还需要为载具配置控制和通讯功能。
